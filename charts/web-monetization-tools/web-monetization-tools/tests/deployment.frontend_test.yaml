suite: web-monetization-tools frontend - Frontend Deployment
templates:
  - configMap.frontend.yaml
  - deployment.frontend.yaml
set:
  fullnameOverride: test-web-monetization-tools
release:
  name: test-web-monetization-tools
tests:
  - it: 'deployment name should be test-web-monetization-tools-frontend'
    asserts:
      - equal:
          path: metadata.name
          value: test-web-monetization-tools-frontend
  - it: 'when overriding tag on the deployment, the container should use that tag'
    template: deployment.frontend.yaml
    set:
      deployments:
        frontend:
          image:
            tag: 2.0.0
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: ghcr.io/interledger/web-monetization-tools-frontend:2.0.0
  - it: 'given that no tag is on the deployment definition, when overriding the tag globally, the container should use that tag'
    template: deployment.frontend.yaml  
    set:
      imageOverride:
        tag: 2.0.0
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: ghcr.io/interledger/web-monetization-tools-frontend:2.0.0
  - it: 'should create configmap with correct environment variables'
    template: configMap.frontend.yaml
    asserts:
      - equal:
          path: metadata.name
          value: test-web-monetization-tools-frontend
      - equal:
          path: data["urls.api"]
          value: "https://your-backend-domain.example.com/"
      - equal:
          path: data["urls.frontend"]
          value: "https://your-frontend-domain.example.com/"
      - equal:
          path: data["urls.interledgerPay"]
          value: "https://interledgerpay.com/extension/"
      - equal:
          path: data["urls.initScript"]
          value: https://cdn.webmonetization.org/
      - equal:
          path: data["openpayments.keyId"]
          value: "00000000-0000-0000-0000-000000000000"
