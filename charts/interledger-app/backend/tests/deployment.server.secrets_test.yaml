suite: Interledger App - Default deployment secret references for server
templates:
  - configMap.yaml
  - deployment.server.yaml
set:
  fullnameOverride: wallet-backend
release:
  name: wallet-backend
tests:
  - it: 'Secret reference for DB_URL_WITH_CERTS should point to the correct key in secret'
    template: deployment.server.yaml
    documentSelector:
      path: kind
      value: Deployment
    asserts:
      - equal:
          path: spec.template.spec.containers[0].env[3].name
          value: DB_URL_WITH_CERTS
      - equal:
          path: spec.template.spec.containers[0].env[3].valueFrom.secretKeyRef.name
          value: wallet-backend
      - equal:
          path: spec.template.spec.containers[0].env[3].valueFrom.secretKeyRef.key
          value: dbBackendURL
  - it: 'Should have GATEHUB_CARD_APP_ID environment variable with correct secret reference'
    template: deployment.server.yaml
    documentSelector:
      path: kind
      value: Deployment
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: GATEHUB_CARD_APP_ID
            valueFrom:
              secretKeyRef:
                name: wallet-backend
                key: gatehubCardAppID
  - it: 'Should have PTI_PUBLIC_KEY_JWK environment variable with correct secret reference'
    template: deployment.server.yaml
    documentSelector:
      path: kind
      value: Deployment
    asserts:
      - contains:
          path: spec.template.spec.containers[0].env
          content:
            name: PTI_PUBLIC_KEY_JWK
            valueFrom:
              secretKeyRef:
                name: wallet-backend
                key: ptiPublicKeyJwk
