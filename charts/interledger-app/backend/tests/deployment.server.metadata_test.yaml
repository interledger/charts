suite: Interledger App - Override image
templates:
  - configMap.yaml
  - deployment.server.yaml
set:
  fullnameOverride: wallet-backend
release:
  name: wallet-backend
tests:
  - it: 'Overriding image should override container image'
    templates:
      - deployment.server.yaml
    set:
      imageOverride:
        repository: europe-west4-docker.pkg.dev/wallet-451208/interledger-app
        name: zulu
        tag: v0.2.2
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: europe-west4-docker.pkg.dev/wallet-451208/interledger-app/zulu:v0.2.2
  - it: 'Server deployment should contain correctly named instance and name labels'
    templates:
      - deployment.server.yaml  
    asserts:
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/instance"]
          value: wallet-backend
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/name"]
          value: wallet-backend-server
  - it: 'Server deployment should contain metadata labels'
    templates:
      - deployment.server.yaml  
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/managed-by"]
          value: Helm
      - exists:
          path: metadata.labels["app.kubernetes.io/version"]
      - exists:
          path: metadata.labels["helm.sh/chart"]
  - it: 'Workload template should contain metadata labels'
    templates:
      - deployment.server.yaml  
    asserts:
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/instance"]
          value: wallet-backend
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/name"]          
          value: wallet-backend-server
  - it: 'should contain configmap hash annotation'
    templates:
      - deployment.server.yaml  
    asserts:
      - exists:
          path: spec.template.metadata.annotations["ilf-configmap-worker-sha256"]