suite: Rafiki Backend - Create key generation job if no keys provided
templates:
  - secret-generator.yaml
release:
  name: rafiki
# Given no keys are provided, a job should be created to generate them.
set:
  key:
    pvk: ''
tests:
  - it: A job should be created to generate keys
    documentSelector:
      path: kind
      value: Job
    asserts:
      - equal:
          path: metadata.name
          value: rafiki-secret-generator
      - equal:
          path: spec.template.spec.restartPolicy
          value: Never
      - equal:
          path: spec.template.spec.containers[0].name
          value: openssl-generator
      - equal:
          path: spec.template.spec.containers[0].image
          value: bitnami/kubectl:latest
  - it: A ServiceAccount should be created for the job
    documentSelector:
      path: kind
      value: ServiceAccount
    asserts:
      - equal:
          path: metadata.name
          value: rafiki-secret-generator
      - equal:
          path: metadata.namespace
          value: NAMESPACE
  - it: A RBAC Role should be created for the job
    documentSelector:
      path: kind
      value: Role
    asserts:
      - equal:
          path: metadata.name
          value: rafiki-secret-generator
      - equal:
          path: metadata.namespace
          value: NAMESPACE
      - equal:
          path: rules[0].apiGroups[0]
          value: ""
      - equal:
          path: rules[0].resources[0]
          value: secrets
      - equal:
          path: rules[0].verbs[0]
          value: create