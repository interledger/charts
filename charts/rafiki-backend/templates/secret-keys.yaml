{{- define "rafiki-backend.secret-keys.tpl" -}}
{{- $top := first . }}
{{/*
  Will generate a Kubernetes Secret containing the private and public keys
  for Rafiki Backend. But only if the values are provided.
  See secret-generator.yaml for the Job that generates these keys in the
  case when they are not provided.
*/}}
{{- if and $top.Values.key.pvk $top.Values.key.pub }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "common.fullname" $top }}-keys
  {{- include "common.metadata"  (list $top) | nindent 2 }}
type: Opaque
data:
  {{- $pvk := $top.Values.key.pvk }}
  pvk.pem: {{ $pvk }}
  {{- $pub := $top.Values.key.pub }}
  pub.pem: {{ $pub }}
{{- end }}
{{- end }}

{{- include "rafiki-backend.secret-keys.tpl" (list .) }}
