suite: Rafiki Backend - Sidecar Test
templates:
  - deployment.yaml
values:
  - samples/sidecar.yaml
release:
  name: rafiki-backend
tests:
  - it: 'Should have correct basic data'
    asserts:
      - containsDocument:
          kind: Deployment
          apiVersion: apps/v1
          name: rafiki-backend
  - it: 'Should contain two containers because second one is the side car'
    asserts:
      - lengthEqual:
          path: spec.template.spec.containers
          count: 2
  - it: 'Second container should be correctly configured'
    asserts:
      - equal:
          path: spec.template.spec.containers[1].name
          value: cloud-sql-proxy
      - equal:
          path: spec.template.spec.containers[1].image
          value: gcr.io/cloud-sql-connectors/cloud-sql-proxy:latest
      
